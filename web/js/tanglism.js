var dataset = [
    {
      "date": "2020-01-02",
      "open": 32.9,
      "close": 33.91,
      "high": 34.37,
      "low": 32.57,
      "volume": 74984234.0,
      "money": 2530294947.61
    },
    {
      "date": "2020-01-03",
      "open": 33.9,
      "close": 34.17,
      "high": 34.3,
      "low": 33.69,
      "volume": 47900997.0,
      "money": 1630745424.36
    },
    {
      "date": "2020-01-06",
      "open": 34.0,
      "close": 34.41,
      "high": 35.12,
      "low": 33.56,
      "volume": 58912538.0,
      "money": 2035676278.52
    },
    {
      "date": "2020-01-07",
      "open": 34.45,
      "close": 34.4,
      "high": 34.96,
      "low": 34.17,
      "volume": 31456151.0,
      "money": 1084694852.22
    },
    {
      "date": "2020-01-08",
      "open": 34.01,
      "close": 34.08,
      "high": 34.79,
      "low": 33.9,
      "volume": 36049030.0,
      "money": 1234135899.75
    },
    {
      "date": "2020-01-09",
      "open": 34.46,
      "close": 34.65,
      "high": 34.78,
      "low": 34.13,
      "volume": 37890997.0,
      "money": 1305627478.21
    },
    {
      "date": "2020-01-10",
      "open": 34.47,
      "close": 34.36,
      "high": 34.66,
      "low": 34.01,
      "volume": 36442765.0,
      "money": 1249566932.25
    },
    {
      "date": "2020-01-13",
      "open": 34.75,
      "close": 35.23,
      "high": 35.5,
      "low": 34.5,
      "volume": 50855250.0,
      "money": 1785657225.55
    },
    {
      "date": "2020-01-14",
      "open": 35.57,
      "close": 35.36,
      "high": 35.6,
      "low": 34.85,
      "volume": 37719451.0,
      "money": 1330874953.76
    },
    {
      "date": "2020-01-15",
      "open": 35.32,
      "close": 36.7,
      "high": 37.0,
      "low": 35.02,
      "volume": 59945960.0,
      "money": 2161517159.76
    },
    {
      "date": "2020-01-16",
      "open": 36.5,
      "close": 36.8,
      "high": 36.9,
      "low": 36.16,
      "volume": 45834312.0,
      "money": 1677054394.31
    },
    {
      "date": "2020-01-17",
      "open": 36.29,
      "close": 35.67,
      "high": 36.55,
      "low": 35.6,
      "volume": 48021052.0,
      "money": 1732968996.55
    },
    {
      "date": "2020-01-20",
      "open": 35.6,
      "close": 36.12,
      "high": 36.67,
      "low": 35.5,
      "volume": 48803321.0,
      "money": 1766903916.16
    },
    {
      "date": "2020-01-21",
      "open": 35.67,
      "close": 34.99,
      "high": 36.06,
      "low": 34.88,
      "volume": 49215107.0,
      "money": 1734473855.45
    },
    {
      "date": "2020-01-22",
      "open": 34.8,
      "close": 36.61,
      "high": 36.8,
      "low": 34.61,
      "volume": 55418587.0,
      "money": 1993790516.75
    },
    {
      "date": "2020-01-23",
      "open": 36.01,
      "close": 36.0,
      "high": 36.82,
      "low": 35.12,
      "volume": 57062403.0,
      "money": 2057230929.35
    },
    {
      "date": "2020-02-03",
      "open": 32.4,
      "close": 32.47,
      "high": 34.2,
      "low": 32.4,
      "volume": 84232907.0,
      "money": 2796702685.74
    },
    {
      "date": "2020-02-04",
      "open": 32.82,
      "close": 34.18,
      "high": 34.29,
      "low": 32.8,
      "volume": 64232348.0,
      "money": 2177880568.67
    },
    {
      "date": "2020-02-05",
      "open": 34.3,
      "close": 35.1,
      "high": 36.1,
      "low": 33.93,
      "volume": 73555887.0,
      "money": 2591506575.27
    },
    {
      "date": "2020-02-06",
      "open": 35.11,
      "close": 35.5,
      "high": 35.73,
      "low": 34.41,
      "volume": 50035614.0,
      "money": 1761107367.17
    },
    {
      "date": "2020-02-07",
      "open": 35.0,
      "close": 35.2,
      "high": 35.5,
      "low": 34.48,
      "volume": 46780370.0,
      "money": 1635388478.32
    },
    {
      "date": "2020-02-10",
      "open": 35.02,
      "close": 35.03,
      "high": 35.15,
      "low": 34.5,
      "volume": 45266143.0,
      "money": 1574848744.31
    },
    {
      "date": "2020-02-11",
      "open": 35.15,
      "close": 35.56,
      "high": 35.85,
      "low": 34.58,
      "volume": 51812994.0,
      "money": 1827309508.99
    },
    {
      "date": "2020-02-12",
      "open": 35.4,
      "close": 36.0,
      "high": 36.11,
      "low": 35.03,
      "volume": 44368267.0,
      "money": 1579577351.54
    },
    {
      "date": "2020-02-13",
      "open": 35.9,
      "close": 35.96,
      "high": 36.65,
      "low": 35.61,
      "volume": 45628760.0,
      "money": 1651770269.72
    },
    {
      "date": "2020-02-14",
      "open": 35.74,
      "close": 35.74,
      "high": 36.76,
      "low": 35.35,
      "volume": 53712672.0,
      "money": 1933923573.88
    },
    {
      "date": "2020-02-17",
      "open": 35.6,
      "close": 37.15,
      "high": 37.24,
      "low": 35.6,
      "volume": 66087167.0,
      "money": 2414717645.96
    },
    {
      "date": "2020-02-18",
      "open": 37.08,
      "close": 36.83,
      "high": 37.08,
      "low": 36.26,
      "volume": 51012126.0,
      "money": 1870151058.27
    },
    {
      "date": "2020-02-19",
      "open": 36.91,
      "close": 38.17,
      "high": 38.51,
      "low": 36.57,
      "volume": 98280870.0,
      "money": 3695422704.53
    },
    {
      "date": "2020-02-20",
      "open": 38.01,
      "close": 38.79,
      "high": 39.13,
      "low": 37.9,
      "volume": 69039830.0,
      "money": 2663056805.05
    },
    {
      "date": "2020-02-21",
      "open": 38.79,
      "close": 39.4,
      "high": 40.09,
      "low": 38.56,
      "volume": 82072444.0,
      "money": 3246530781.26
    }
  ];

var w = 500, h = 300;

var svg = d3.select("body")
    .append("svg")
    .attr("width", w)
    .attr("height", h);

var price_max = d3.max(dataset, function(d) {
    return d.high;
});
var price_min = d3.min(dataset, function(d) {
    return d.low;
})

var yscale = d3.scaleLinear([price_min, price_max], [0, h]);

svg.selectAll("rect").data(dataset).enter().append("rect")
    .attr("x", function(d, i) {
        return i * (w/dataset.length);
    })
    .attr('y', function(d, i) {
        return h - yscale(d3.max([d.open, d.close]));
    })
    .attr('width', function(d, i) {
        return w / dataset.length - 4;
    })
    .attr("height", function(d) {
        return Math.abs(yscale(d.open) - yscale(d.close));
    })
    .attr("fill", function(d) {
        if (d.open < d.close) return "red";
        return "green";
    });

var data_cnt = dataset.length;
var barPadding = 4;
svg.selectAll("line")
    .data(dataset)
    .enter()
    .append("line")
    .attr("x1", function(d, i) {
        return i * (w / data_cnt) + (w / data_cnt - barPadding) / 2;
    })
    .attr("x2", function(d, i) {
        return i * (w / data_cnt) + (w / data_cnt - barPadding) / 2;
    })
    .attr("y1", function(d) {
        return h - yscale(d.high);
    })
    .attr("y2", function(d) {
        return h - yscale(d.low);
    })
    .attr("stroke", function(d) {
        if (d.open < d.close) return "red";
        return "green";
    });
